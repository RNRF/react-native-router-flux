Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.actionMap=void 0;var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _reactNavigation=require("react-navigation");var _propTypes=_interopRequireDefault(require("prop-types"));var _lodash=_interopRequireDefault(require("lodash.isequal"));var ActionConst=_interopRequireWildcard(require("./ActionConst"));var _Util=require("./Util");var _NavBar=require("./NavBar");var _LightboxNavigator=_interopRequireDefault(require("./LightboxNavigator"));var _menu_burger=_interopRequireDefault(require("../images/menu_burger.png"));var _Scene=_interopRequireDefault(require("./Scene"));var _State=require("./State");var _Modal=_interopRequireDefault(require("./Modal"));var _Lightbox=_interopRequireDefault(require("./Lightbox"));var _Drawer=_interopRequireDefault(require("./Drawer"));var _Tabs=_interopRequireDefault(require("./Tabs"));var _Overlay=_interopRequireDefault(require("./Overlay"));var _OverlayNavigator=_interopRequireDefault(require("./OverlayNavigator"));var _actionMap,_jsxFileName="/Users/daviscabral/Projects/open-source/react-native-router-flux/src/navigationStore.js";function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter){if((typeof Symbol==="function"?Symbol.iterator:"@@iterator")in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty(target,key,source[key]);});}return target;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var RightNavBarButton;var LeftNavBarButton;var BackNavBarButton;var counter=0;var actionMap=(_actionMap={},_defineProperty(_actionMap,ActionConst.JUMP,'jump'),_defineProperty(_actionMap,ActionConst.PUSH,'push'),_defineProperty(_actionMap,ActionConst.REPLACE,'replace'),_defineProperty(_actionMap,ActionConst.BACK,'pop'),_defineProperty(_actionMap,ActionConst.BACK_ACTION,'pop'),_defineProperty(_actionMap,ActionConst.POP_TO,'popTo'),_defineProperty(_actionMap,ActionConst.REFRESH,'refresh'),_defineProperty(_actionMap,ActionConst.RESET,'reset'),_defineProperty(_actionMap,ActionConst.PUSH_OR_POP,'push'),_actionMap);exports.actionMap=actionMap;var reservedKeys=['children','refs','addRef','removeRef','create','execute','popTo','navigate','replace','refresh','dispatch','push','setParams','run','onEnter','onRight','onLeft','left','back','right','rightButton','leftButton','on','onExit','pop','renderLeftButton','renderRightButton','renderTitle','navBar','title','drawerOpen','drawerClose'];var dontInheritKeys=['component','contentComponent','tabBarComponent','modal','drawer','lightbox','overlay','tabs','navigator','children','key','ref','style','title','navTransparent','type','hideNavBar','hideTabBar','backToInitial'];function getValue(value,params){return value instanceof Function?value(params):value;}function getProperties(){var component=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var res={};for(var _i=0;_i<reservedKeys.length;_i++){var _key=reservedKeys[_i];if(component[_key]){res[_key]=component[_key];}}delete res.children;return res;}function createTabBarOptions(_ref){var tabBarStyle=_ref.tabBarStyle,activeTintColor=_ref.activeTintColor,inactiveTintColor=_ref.inactiveTintColor,activeBackgroundColor=_ref.activeBackgroundColor,inactiveBackgroundColor=_ref.inactiveBackgroundColor,showLabel=_ref.showLabel,labelStyle=_ref.labelStyle,tabStyle=_ref.tabStyle,props=_objectWithoutProperties(_ref,["tabBarStyle","activeTintColor","inactiveTintColor","activeBackgroundColor","inactiveBackgroundColor","showLabel","labelStyle","tabStyle"]);return _objectSpread({},props,{style:tabBarStyle,activeTintColor:activeTintColor,inactiveTintColor:inactiveTintColor,activeBackgroundColor:activeBackgroundColor,inactiveBackgroundColor:inactiveBackgroundColor,showLabel:showLabel,labelStyle:labelStyle,tabStyle:tabStyle});}function createNavigationOptions(params){var title=params.title,backButtonImage=params.backButtonImage,navTransparent=params.navTransparent,backToInitial=params.backToInitial,hideNavBar=params.hideNavBar,hideTabBar=params.hideTabBar,backTitle=params.backTitle,right=params.right,rightButton=params.rightButton,left=params.left,leftButton=params.leftButton,navigationBarStyle=params.navigationBarStyle,headerStyle=params.headerStyle,navBarButtonColor=params.navBarButtonColor,tabBarLabel=params.tabBarLabel,tabBarIcon=params.tabBarIcon,icon=params.icon,getTitle=params.getTitle,renderTitle=params.renderTitle,panHandlers=params.panHandlers,navigationBarTitleImage=params.navigationBarTitleImage,navigationBarTitleImageStyle=params.navigationBarTitleImageStyle,component=params.component,rightTitle=params.rightTitle,leftTitle=params.leftTitle,leftButtonTextStyle=params.leftButtonTextStyle,rightButtonTextStyle=params.rightButtonTextStyle,backButtonTextStyle=params.backButtonTextStyle,headerTitleStyle=params.headerTitleStyle,titleStyle=params.titleStyle,navBar=params.navBar,onRight=params.onRight,onLeft=params.onLeft,rightButtonImage=params.rightButtonImage,leftButtonImage=params.leftButtonImage,init=params.init,back=params.back,renderBackButton=params.renderBackButton,renderNavigationBar=params.renderNavigationBar,hideDrawerButton=params.hideDrawerButton,drawerIcon=params.drawerIcon,drawerImage=params.drawerImage,drawerPosition=params.drawerPosition,props=_objectWithoutProperties(params,["title","backButtonImage","navTransparent","backToInitial","hideNavBar","hideTabBar","backTitle","right","rightButton","left","leftButton","navigationBarStyle","headerStyle","navBarButtonColor","tabBarLabel","tabBarIcon","icon","getTitle","renderTitle","panHandlers","navigationBarTitleImage","navigationBarTitleImageStyle","component","rightTitle","leftTitle","leftButtonTextStyle","rightButtonTextStyle","backButtonTextStyle","headerTitleStyle","titleStyle","navBar","onRight","onLeft","rightButtonImage","leftButtonImage","init","back","renderBackButton","renderNavigationBar","hideDrawerButton","drawerIcon","drawerImage","drawerPosition"]);var NavBar=renderNavigationBar||navBar;if(component&&component.navigationOptions){return component.navigationOptions;}return function(_ref2){var navigation=_ref2.navigation,screenProps=_ref2.screenProps;console.log('PARAMS',screenProps);var navigationParams=navigation.state.params||{};var state=_objectSpread({navigation:navigation},params,navigationParams,screenProps);var res=_objectSpread({},props,{headerTintColor:navBarButtonColor||props.tintColor||navigationParams.tintColor||navigationParams.headerTintColor,headerTitleStyle:headerTitleStyle||titleStyle,title:getValue(navigationParams.title||title||getTitle,state),headerBackTitle:getValue(navigationParams.backTitle||backTitle,state),headerRight:getValue(navigationParams.right||right||rightButton||params.renderRightButton,state),headerLeft:getValue(navigationParams.left||left||leftButton||params.renderLeftButton,state),headerTitle:getValue(navigationParams.renderTitle||renderTitle||params.renderTitle,state),headerStyle:getValue(navigationParams.headerStyle||headerStyle||navigationBarStyle,state),headerBackImage:navigationParams.backButtonImage||backButtonImage});var NavBarFromParams=navigationParams.renderNavigationBar||navigationParams.navBar;if(NavBarFromParams!=null){if(NavBarFromParams){res.header=function(data){return _react.default.createElement(NavBarFromParams,_extends({navigation:navigation},state,data,{__source:{fileName:_jsxFileName,lineNumber:203}}));};}}else if(NavBar){res.header=function(data){return _react.default.createElement(NavBar,_extends({navigation:navigation},state,data,{__source:{fileName:_jsxFileName,lineNumber:206}}));};}if(typeof navigationParams.panHandlers!=='undefined'){if(navigationParams.panHandlers===null){res.gesturesEnabled=false;}}else if(panHandlers===null){res.gesturesEnabled=false;}if(navigationBarTitleImage){res.headerTitle=_react.default.createElement(_reactNative.Image,{source:navigationBarTitleImage,style:navigationBarTitleImageStyle,__source:{fileName:_jsxFileName,lineNumber:218}});}if(tabBarLabel){res.tabBarLabel=tabBarLabel;}if(tabBarIcon||icon){var Icon=tabBarIcon||icon;res.tabBarIcon=function(data){return _react.default.createElement(Icon,_extends({},state,data,{__source:{fileName:_jsxFileName,lineNumber:227}}));};}var componentData={};if(component){var _arr=['onRight','onLeft','rightButton','leftButton','leftTitle','rightTitle','rightButtonImage','leftButtonImage','rightButtonTextStyle','leftButtonTextStyle','rightButtonIconStyle','leftButtonIconStyle','leftButtonTintColor','rightButtonTintColor'];for(var _i2=0;_i2<_arr.length;_i2++){var _key3=_arr[_i2];if(component[_key3]){componentData[_key3]=component[_key3];}}}if(rightButtonImage||rightTitle||params.renderRightButton||onRight||navigationParams.onRight||navigationParams.rightTitle||navigationParams.rightButtonImage||rightButtonTextStyle||(drawerImage||drawerIcon)&&!hideDrawerButton&&drawerPosition==='right'){res.headerRight=getValue(navigationParams.right||navigationParams.rightButton||params.renderRightButton,_objectSpread({},navigationParams,screenProps))||_react.default.createElement(RightNavBarButton,_extends({},params,navigationParams,componentData,{__source:{fileName:_jsxFileName,lineNumber:266}}));}if(leftButtonImage||backButtonImage||backTitle||leftTitle||params.renderLeftButton||leftButtonTextStyle||renderBackButton||backButtonTextStyle||onLeft||navigationParams.leftTitle||navigationParams.onLeft||navigationParams.leftButtonImage||navigationParams.backButtonImage||navigationParams.backTitle||(drawerImage||drawerIcon)&&!hideDrawerButton&&drawerPosition!=='right'){res.headerLeft=getValue(navigationParams.left||navigationParams.leftButton||params.renderLeftButton,_objectSpread({},params,navigationParams,screenProps))||(onLeft&&(leftTitle||navigationParams.leftTitle||leftButtonImage||navigationParams.leftButtonImage)||drawerImage||drawerIcon)&&_react.default.createElement(LeftNavBarButton,_extends({},params,navigationParams,componentData,{__source:{fileName:_jsxFileName,lineNumber:289}}))||res.headerLeft||(init?null:renderBackButton&&renderBackButton(state)||_react.default.createElement(BackNavBarButton,_extends({},state,{__source:{fileName:_jsxFileName,lineNumber:292}})));}if(back){res.headerLeft=renderBackButton&&renderBackButton(state)||_react.default.createElement(BackNavBarButton,_extends({},state,{__source:{fileName:_jsxFileName,lineNumber:296}}));}if(typeof navigationParams.left!=='undefined'||typeof navigationParams.leftButton!=='undefined'||typeof navigationParams.renderLeftButton!=='undefined'){if(navigationParams.left===null||navigationParams.leftButton===null||navigationParams.renderLeftButton===null){res.headerLeft=null;}}if(navigationParams.hideTabBar!=null){if(navigationParams.hideTabBar){res.tabBarVisible=false;}}else if(hideTabBar){res.tabBarVisible=false;}console.log('NAVIGATION PARAMS:',JSON.stringify(navigationParams));if(navigationParams.hideNavBar!=null){if(navigationParams.hideNavBar){res.header=null;}}else if(hideNavBar){res.header=null;}if(navTransparent){res.headerStyle={backgroundColor:'transparent',zIndex:100,borderBottomWidth:0,elevation:1};}if(backToInitial){res.tabBarOnPress=function(_ref3){var scene=_ref3.scene,jumpToIndex=_ref3.jumpToIndex;if(scene.focused){if(scene.route.index!==0){for(var _i3=1;_i3<scene.route.routes.length;_i3++){navigation.dispatch(_reactNavigation.NavigationActions.back());}}}else{jumpToIndex(scene.index);}};}return res;};}function originalRouteName(routeName){if(routeName.startsWith('_')){return routeName.substring(1);}return routeName;}function extendProps(props,store){if(!props){return{};}var res=_objectSpread({},props);var _loop=function _loop(transition){if(reservedKeys.indexOf(transition)===-1&&transition.startsWith('on')&&transition.charAt(2)>='A'&&transition.charAt(2)<='Z'&&typeof props[transition]==='string'){if(store[props[transition]]){res[transition]=function(params){return store[props[transition]](params);};}}};var _arr2=Object.keys(props);for(var _i4=0;_i4<_arr2.length;_i4++){var transition=_arr2[_i4];_loop(transition);}return res;}function createWrapper(Component,wrapBy,store){if(!Component){return null;}var wrapper=wrapBy||function(props){return props;};if(!Component.prototype||Component.prototype.render){var Wrapped=function(_React$Component){_inherits(Wrapped,_React$Component);function Wrapped(){var _this;_classCallCheck(this,Wrapped);_this=_possibleConstructorReturn(this,_getPrototypeOf(Wrapped).call(this));_this.onRef=_this.onRef.bind(_assertThisInitialized(_assertThisInitialized(_this)));return _this;}_createClass(Wrapped,[{key:"componentDidMount",value:function componentDidMount(){var navigation=this.props.navigation;if(this.ref&&navigation&&navigation.state&&navigation.state.routeName){store.addRef(originalRouteName(navigation.state.routeName),this.ref);}if(this.ref&&this.ref.onEnter){this.ref.onEnter(navigation&&navigation.state);}}},{key:"componentWillUnmount",value:function componentWillUnmount(){var navigation=this.props.navigation;if(this.ref&&navigation&&navigation.state&&navigation.state.routeName){store.deleteRef(originalRouteName(navigation.state.routeName));}if(this.ref&&this.ref.onExit){this.ref.onExit(navigation&&navigation.state);}this.ref=null;}},{key:"onRef",value:function onRef(ref){this.ref=ref;}},{key:"render",value:function render(){var navigation=this.props.navigation;if(!navigation||!navigation.state){return _react.default.createElement(Component,_extends({ref:this.onRef},this.props,{__source:{fileName:_jsxFileName,lineNumber:431}}));}return _react.default.createElement(Component,_extends({ref:this.onRef},this.props,extendProps(navigation.state.params,store),{name:navigation.state.routeName,__source:{fileName:_jsxFileName,lineNumber:433}}));}}]);return Wrapped;}(_react.default.Component);Wrapped.propTypes={navigation:_propTypes.default.object};return wrapper(Wrapped);}function StatelessWrapped(_ref4){var navigation=_ref4.navigation,props=_objectWithoutProperties(_ref4,["navigation"]);return _react.default.createElement(Component,_extends({},props,{navigation:navigation},extendProps(navigation.state.params,store),{name:navigation.state.routeName,__source:{fileName:_jsxFileName,lineNumber:441}}));}StatelessWrapped.propTypes={navigation:_propTypes.default.object};return wrapper(StatelessWrapped);}function filterParam(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(data.toString()!=='[object Object]'){return{data:data};}var proto=(data||{}).constructor.name;if(!data||proto!=='Object'){return{};}return data;}function uniteParams(routeName,params){var res={};for(var _iterator=params,_isArray=Array.isArray(_iterator),_i5=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref5;if(_isArray){if(_i5>=_iterator.length)break;_ref5=_iterator[_i5++];}else{_i5=_iterator.next();if(_i5.done)break;_ref5=_i5.value;}var _param2=_ref5;if(_param2){res=_objectSpread({},res,filterParam(_param2));}}res.routeName=routeName;return res;}var defaultSuccess=function defaultSuccess(){};var defaultFailure=function defaultFailure(){};var NavigationStore=function(){function NavigationStore(){var _this2=this;_classCallCheck(this,NavigationStore);this._navigator=null;this.refs={};this.states={};this.onNavigationStateChange=function(prevState,currentState,action){_this2.state=currentState;_this2.prevState=prevState;_this2.currentParams=action.params;};this.setTopLevelNavigator=function(navigatorRef){_this2._navigator=navigatorRef;};this.addRef=function(name,ref){_this2.refs[name]=ref;};this.deleteRef=function(name){delete _this2.refs[name];};this.create=function(scene){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var wrapBy=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(props){return props;};(0,_Util.assert)(!Array.isArray(scene),'Router should contain only one scene, please wrap your scenes with root Scene ');RightNavBarButton=wrapBy(_NavBar.RightButton);LeftNavBarButton=wrapBy(_NavBar.LeftButton);BackNavBarButton=wrapBy(_NavBar.BackButton);var AppNavigator=_this2.processScene(scene,params,[],wrapBy);return AppNavigator;};this.processScene=function(scene){var inheritProps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var clones=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var wrapBy=arguments.length>3?arguments[3]:undefined;(0,_Util.assert)(scene.props,'props should be defined');if(!scene.props.children){return null;}var res={};var order=[];var _scene$props=scene.props,navigator=_scene$props.navigator,contentComponent=_scene$props.contentComponent,drawerWidth=_scene$props.drawerWidth,drawerLockMode=_scene$props.drawerLockMode,lazy=_scene$props.lazy,duration=_scene$props.duration,parentProps=_objectWithoutProperties(_scene$props,["navigator","contentComponent","drawerWidth","drawerLockMode","lazy","duration"]);var tabs=parentProps.tabs,modal=parentProps.modal,lightbox=parentProps.lightbox,overlay=parentProps.overlay,tabBarPosition=parentProps.tabBarPosition,drawer=parentProps.drawer,tabBarComponent=parentProps.tabBarComponent,transitionConfig=parentProps.transitionConfig;if(scene.type===_Modal.default){modal=true;}else if(scene.type===_Drawer.default){drawer=true;}else if(scene.type===_Lightbox.default){lightbox=true;}else if(scene.type===_Tabs.default){tabs=true;}else if(scene.type===_Overlay.default){overlay=true;}if(duration!==undefined&&!transitionConfig){transitionConfig=function transitionConfig(){return{transitionSpec:{duration:duration,timing:_reactNative.Animated.timing,easing:_reactNative.Easing.step0}};};}var commonProps=_objectSpread({},inheritProps,parentProps);delete commonProps.children;delete commonProps.component;var _arr3=Object.keys(commonProps);for(var _i6=0;_i6<_arr3.length;_i6++){var _pkey=_arr3[_i6];if(dontInheritKeys.includes(_pkey)&&(_pkey==='type'||_pkey==='hideNavBar'||!parentProps[_pkey])){delete commonProps[_pkey];}}if(drawer){commonProps.drawerImage=commonProps.drawerImage||_menu_burger.default;}var children=!Array.isArray(parentProps.children)?[parentProps.children]:[].concat.apply([],parentProps.children);if(!drawer&&!tabs&&!overlay){children.push.apply(children,_toConsumableArray(clones));}for(var _iterator2=children,_isArray2=Array.isArray(_iterator2),_i7=0,_iterator2=_isArray2?_iterator2:_iterator2[typeof Symbol==="function"?typeof Symbol==="function"?typeof Symbol==="function"?Symbol.iterator:"@@iterator":"@@iterator":"@@iterator"]();;){var _ref6;if(_isArray2){if(_i7>=_iterator2.length)break;_ref6=_iterator2[_i7++];}else{_i7=_iterator2.next();if(_i7.done)break;_ref6=_i7.value;}var _child3=_ref6;if(_child3.props.clone){if(clones.indexOf(_child3)===-1){clones.push(_child3);}}}var initialRouteName;var initialRouteParams;var _loop2=function _loop2(_child){var key=_child.key||"key"+counter++;var init=key===children[0].key;(0,_Util.assert)(reservedKeys.indexOf(key)===-1,"Scene name cannot be reserved word: "+_child.key);var _child$props=_child.props,component=_child$props.component,_child$props$type=_child$props.type,type=_child$props$type===void 0?tabs||drawer?'jump':'push':_child$props$type,path=_child$props.path,onEnter=_child$props.onEnter,onExit=_child$props.onExit,on=_child$props.on,failure=_child$props.failure,success=_child$props.success,wrap=_child$props.wrap,_child$props$initial=_child$props.initial,initial=_child$props$initial===void 0?false:_child$props$initial,props=_objectWithoutProperties(_child$props,["component","type","path","onEnter","onExit","on","failure","success","wrap","initial"]);if(!_this2.states[key]){_this2.states[key]={};}var _arr4=Object.keys(props);for(var _i9=0;_i9<_arr4.length;_i9++){var _transition=_arr4[_i9];if(reservedKeys.indexOf(_transition)===-1&&props[_transition]instanceof Function){_this2.states[key][_transition]=props[_transition];}}delete props.children;if(success){_this2.states[key].success=success instanceof Function?success:function(args){console.log("Transition to state="+success);_this2[success](args);};}if(failure){_this2.states[key].failure=failure instanceof Function?failure:function(args){console.log("Transition to state="+failure);_this2[failure](args);};}if(path){_this2.states[key].path=path;}var screen={screen:createWrapper(component,wrapBy,_this2)||_this2.processScene(_child,commonProps,clones)||lightbox&&function(){return null;},navigationOptions:createNavigationOptions(_objectSpread({},commonProps,{hideNavBar:parentProps.hideNavBar},getProperties(component),_child.props,{init:init,component:component}))};var wrapNavBar=drawer||tabs||wrap;if(wrap===false||commonProps.wrap===false){wrapNavBar=false;}if(component&&wrapNavBar){res[key]={screen:_this2.processScene({key:key,props:{children:{key:"_"+key,props:_objectSpread({},_child.props,{wrap:false})}}},commonProps,clones,wrapBy),navigationOptions:createNavigationOptions(_objectSpread({},commonProps,_child.props,{hideNavBar:true}))};}else{res[key]=screen;}props.init=true;if(!_this2[key]){_this2[key]=new Function('actions','props','type',"return function "+key.replace(/\W/g,'_')+"(params){ actions.execute(type, '"+key+"', props, params)}")(_this2,_objectSpread({},commonProps,props),type);}if((onEnter||on||component&&component.onEnter)&&!_this2[key+_Util.OnEnter]){_this2[key+_Util.OnEnter]=onEnter||on||component.onEnter;}if((onExit||component&&component.onExit)&&!_this2[key+_Util.OnExit]){_this2[key+_Util.OnExit]=onExit||component.onExit;}order.push(key);if(initial||_child.props.initial||!initialRouteName){initialRouteName=key;initialRouteParams=_objectSpread({},commonProps,props);}};for(var _iterator3=children,_isArray3=Array.isArray(_iterator3),_i8=0,_iterator3=_isArray3?_iterator3:_iterator3[typeof Symbol==="function"?typeof Symbol==="function"?typeof Symbol==="function"?Symbol.iterator:"@@iterator":"@@iterator":"@@iterator"]();;){var _ref7;if(_isArray3){if(_i8>=_iterator3.length)break;_ref7=_iterator3[_i8++];}else{_i8=_iterator3.next();if(_i8.done)break;_ref7=_i8.value;}var _child=_ref7;_loop2(_child);}var mode=modal?'modal':'card';if(navigator){return navigator(res,_objectSpread({lazy:lazy,initialRouteName:initialRouteName,initialRouteParams:initialRouteParams,contentComponent:contentComponent,order:order},commonProps,{navigationOptions:createNavigationOptions(commonProps)}));}if(lightbox){return(0,_LightboxNavigator.default)(res,_objectSpread({mode:mode,initialRouteParams:initialRouteParams,initialRouteName:initialRouteName},commonProps,{navigationOptions:createNavigationOptions(commonProps)}));}if(tabs){if(!tabBarComponent){tabBarComponent=tabBarPosition==='top'?function(props){return _react.default.createElement(_reactNavigation.TabBarTop,_extends({},props,commonProps,{__source:{fileName:_jsxFileName,lineNumber:709}}));}:function(props){return _react.default.createElement(_reactNavigation.TabBarBottom,_extends({},props,commonProps,{__source:{fileName:_jsxFileName,lineNumber:709}}));};}if(!tabBarPosition){tabBarPosition=_reactNative.Platform.OS==='android'?'top':'bottom';}return(0,_reactNavigation.createTabNavigator)(res,_objectSpread({lazy:lazy,tabBarComponent:tabBarComponent,tabBarPosition:tabBarPosition,initialRouteName:initialRouteName,initialRouteParams:initialRouteParams,order:order},commonProps,{tabBarOptions:createTabBarOptions(commonProps),navigationOptions:createNavigationOptions(commonProps)}));}if(drawer){var config=_objectSpread({initialRouteName:initialRouteName,contentComponent:contentComponent,order:order,drawerOpenRoute:'DrawerOpen',drawerCloseRoute:'DrawerClose',drawerToggleRoute:'DrawerToggle'},commonProps);if(drawerWidth){config.drawerWidth=drawerWidth;}if(drawerLockMode){config.drawerLockMode=drawerLockMode;}return(0,_reactNavigation.createDrawerNavigator)(res,config);}if(overlay){return(0,_OverlayNavigator.default)(res,_objectSpread({lazy:lazy,initialRouteName:initialRouteName,contentComponent:contentComponent,initialRouteParams:initialRouteParams,order:order},commonProps,{tabBarOptions:createTabBarOptions(commonProps),navigationOptions:createNavigationOptions(commonProps)}));}return(0,_reactNavigation.createStackNavigator)(res,_objectSpread({mode:mode,initialRouteParams:initialRouteParams,initialRouteName:initialRouteName},commonProps,{transitionConfig:transitionConfig,navigationOptions:createNavigationOptions(commonProps)}));};this.dispatch=function(action){console.log('DISPATCH:',JSON.stringify(action));_this2._navigator.dispatch(action);};this.execute=function(actionType,routeName){for(var _len=arguments.length,params=new Array(_len>2?_len-2:0),_key4=2;_key4<_len;_key4++){params[_key4-2]=arguments[_key4];}var res=uniteParams(routeName,params);var overridenType=res.type||actionType;var type=actionMap[overridenType]||overridenType;if(type==='pop'){_this2[type](res);}else{_this2[type](routeName,res);}};this.push=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:_reactNavigation.NavigationActions.NAVIGATE,routeName:routeName,params:params});};this.jump=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:_reactNavigation.NavigationActions.NAVIGATE,routeName:routeName,params:params});};this.drawerOpen=function(){_this2.dispatch(_reactNavigation.DrawerActions.openDrawer());};this.drawerClose=function(){_this2.dispatch(_reactNavigation.DrawerActions.closeDrawer());};this.drawerToggle=function(){_this2.dispatch(_reactNavigation.DrawerActions.toggleDrawer());};this.refresh=function(data){var params=filterParam(data);var key=(0,_State.getActiveState)(_this2.state).key;_this2.dispatch(_reactNavigation.NavigationActions.setParams({key:key,params:params}));};this.pop=function(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},timeout=_ref8.timeout,params=_objectWithoutProperties(_ref8,["timeout"]);var res=filterParam(params);if(timeout){setTimeout(function(){return _this2.pop(params);},timeout);}else{_this2.dispatch(_reactNavigation.NavigationActions.back());if(res.refresh){_this2.refresh(res.refresh);}}return true;};this.popTo=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.POP_TO,routeName:routeName,params:params});};this.popAndPush=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.POP_AND_PUSH,routeName:routeName,params:params});};this.replace=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.REPLACE,routeName:routeName,params:params});};this.reset=function(routeName,data){var params=filterParam(data);_this2.dispatch(_reactNavigation.NavigationActions.reset({key:null,index:0,actions:[_reactNavigation.NavigationActions.navigate({routeName:routeName,params:params})]}));};}_createClass(NavigationStore,[{key:"currentScene",get:function get(){return(0,_State.getActiveState)(this.state);}},{key:"prevScene",get:function get(){return(0,_State.getActiveState)(this.prevState);}}]);return NavigationStore;}();var _default=new NavigationStore();exports.default=_default;